<!DOCTYPE html>
<html>
<head>
   <title>Evaporate Example</title>

   <style>

   </style>


   <script language="javascript" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
   <script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.43.min.js"></script>
   <script language="javascript" type="text/javascript" src="../evaporate.js"></script>
</head>
<body>
  <h1>Using EvaporateJS with AWS V4 Signatures</h1>
  <div>
    <h2>Demo</h2>
    <input type="file" id="files"  multiple />
  </div>
  <p>To get this code working, you'll need to setup your S3 bucket first (see the <a href="https://github.com/TTLabs/EvaporateJS#configuring-the-aws-s3-bucket">README</a>). You'll also need to change <strong>this</strong> file's <code>Evaporate.create()</code> call:</p>
  <ul>
    <li>aws_key -- change this to your AWS_ACCESS_KEY_ID</li>
    <li>awsRegion -- change if your bucket is not us-east-1</li>
    <li>bucket -- set this to your actual bucket name</li>
  </ul>


  <script language="javascript">
  var files, filePromises = [], allCompleted;

  Evaporate.create({
    signerUrl: 'http://localhost:3000/signv4_auth',
    aws_key: '<aws_key>',
    awsRegion: 'us-east-1',
    bucket: '<bucket-name>',
    awsSignatureVersion: '4',
    computeContentMd5: true,
    cryptoMd5Method: function (data) { return AWS.util.crypto.md5(data, 'base64'); },
    cryptoHexEncodedHash256: function (data) { return AWS.util.crypto.sha256(data, 'hex'); }
  })
  .then(
    // Successfully created evaporate instance `_e_`
    function (_e_) {
      files = evt.target.files;
      for (var i = 0; i < files.length; i++) {
        var promise = _e_.add({
          name: 'test_' + Math.floor(1000000000*Math.random()),
          file: files[i],
          progress: function (progress) {
            console.log('making progress: ' + progress);
          }
        })
        .then(function (awsKey) {
          console.log(awsKey, 'complete!');
        });
        filePromises.push(promise);
      }

      allCompleted = Promise.all(filePromises)
        .then(function () {
          console.log('All files were uploaded successfully.');
        }, function (reason) {
          console.log('All files were not uploaded successfully:', reason);
        });

      $(evt.target).val('');
    },

    // Failed to create new instance of evaporate
    function (reason) {
       console.log('Evaporate failed to initialize: ', reason)
    }
  );
  </script>
</body>
</html>
